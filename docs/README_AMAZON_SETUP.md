# Amazon PA-API v5 セットアップガイド

⚠️ **重要**: Amazon PA-APIはフロントエンドから直接呼び出すことができません。本格運用時はSupabase Functionsまたは独自APIサーバーでの実装が必要です。

## 🎯 現在の実装状況

### 開発環境（現在）
- **フロントエンド**: 強化されたモックデータを使用
- **商品データ**: リアルな商品情報（価格、画像URL、アフィリエイトリンク付き）
- **検索機能**: キーワードベースの商品マッチング

### 本格運用時
- **サーバーサイド**: Supabase Functions経由でAmazon PA-API v5を呼び出し
- **セキュリティ**: APIキーはサーバーサイドで管理
- **パフォーマンス**: キャッシュ機能とレート制限対応

## 1. Amazonアソシエイト・プログラムへの登録

### ステップ 1: アソシエイト登録
1. [Amazonアソシエイト・プログラム](https://affiliate.amazon.co.jp/)にアクセス
2. 「今すぐ登録」をクリック
3. 必要情報を入力して登録申請
4. 審査を待つ（通常1-3日）
5. 承認後、アソシエイトタグ（Associate Tag）を取得

### ステップ 2: Product Advertising API (PA-API) v5 申請
1. [Developer Central](https://webservices.amazon.co.jp/paapi5/documentation/)にアクセス
2. PA-API v5への申請を行う
3. 以下の条件を満たす必要があります：
   - 過去30日間に3回以上の売上実績
   - アクティブなWebサイトまたはアプリを持っている

### ステップ 3: APIキーの取得
承認後、以下の認証情報を取得：
- Access Key ID
- Secret Access Key
- Associate Tag (Partner Tag)

## 2. 環境変数の設定

以下の環境変数を設定してください：

```bash
# .env ファイルに追加
VITE_AMAZON_ACCESS_KEY=AKIA******************
VITE_AMAZON_SECRET_KEY=****************************************
VITE_AMAZON_ASSOCIATE_TAG=your-associate-tag-20
VITE_AMAZON_REGION=FE  # 日本の場合
```

## 3. 必要な依存関係

```json
{
  "dependencies": {
    "paapi5-nodejs-sdk": "^1.0.1"
  }
}
```

## 4. テスト用コマンド

```bash
# パッケージインストール
npm install

# Amazon API接続テスト
npm run test:amazon-api
```

## 5. 重要な注意事項

### API利用制限
- **1日のリクエスト上限**: 8,640リクエスト（10秒に1回）
- **時間あたりの上限**: 360リクエスト
- **1秒あたりの上限**: 1リクエスト

### 利用規約
- 商品情報は最大24時間キャッシュ可能
- 価格情報は常に最新を表示する必要あり
- 商品画像は適切なサイズで表示

### 売上実績要件
- **継続利用の条件**: 180日以内に売上実績が必要
- 売上がない場合、API アクセスが停止される可能性

## 6. 開発環境での制限事項

開発中はAPI制限のため、以下の対策を推奨：
- キャッシュ機能の実装
- フォールバック用のモック データ
- リクエスト頻度の制御

## 7. 本番運用時のベストプラクティス

- エラーハンドリングの実装
- レート制限の遵守
- 適切なキャッシュ戦略
- ユーザー体験を損なわないフォールバック

## トラブルシューティング

### よくあるエラー
1. **403 Forbidden**: API キーが無効 / PA-API未承認
2. **429 Too Many Requests**: リクエスト制限超過
3. **400 Bad Request**: リクエストパラメータが不正

### 対処法
- API キーの確認
- リクエスト頻度の調整
- エラーログの詳細確認